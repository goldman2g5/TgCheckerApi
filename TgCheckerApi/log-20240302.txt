2024-03-02 11:15:58.409 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-02 11:15:58.574 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-02 11:15:58.614 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-02 11:15:58.614 +03:00 [INF] Quartz Scheduler created
2024-03-02 11:15:58.618 +03:00 [INF] RAMJobStore initialized.
2024-03-02 11:15:58.619 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-02 11:15:58.620 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-02 11:15:58.620 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-02 11:15:58.622 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:15:58.664 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:15:58.840 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-02 11:15:58.841 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-02 11:15:58.845 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-02 11:15:58.846 +03:00 [INF] Hosting environment: Development
2024-03-02 11:15:58.846 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-02 11:15:58.923 +03:00 [INF] RecalculateTopPosJob started at "2024-03-02T11:15:58.9225740+03:00"
2024-03-02 11:15:59.135 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-02 11:15:59.162 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-02 11:15:59.171 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-02 11:15:59.239 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-02 11:15:59.268 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-02 11:15:59.270 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 139.6870ms
2024-03-02 11:15:59.271 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=9zF2YbBCRIYK_VSBLtmMeA - -
2024-03-02 11:15:59.272 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-02 11:15:59.409 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 246.8494ms
2024-03-02 11:15:59.436 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-02 11:15:59.440 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 3.9161ms
2024-03-02 11:15:59.447 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-02 11:15:59.467 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 20.5476ms
2024-03-02 11:15:59.557 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-02 11:15:59.669 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 111.3137ms
2024-03-02 11:16:00.440 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-02 11:16:00.604 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-02T11:16:00.6042399+03:00"
2024-03-02 11:16:28.089 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-02 11:16:28.248 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-02 11:16:28.288 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-02 11:16:28.292 +03:00 [INF] Quartz Scheduler created
2024-03-02 11:16:28.293 +03:00 [INF] RAMJobStore initialized.
2024-03-02 11:16:28.294 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-02 11:16:28.295 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-02 11:16:28.295 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-02 11:16:28.297 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:16:28.341 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:16:28.536 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-02 11:16:28.537 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-02 11:16:28.540 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-02 11:16:28.541 +03:00 [INF] Hosting environment: Development
2024-03-02 11:16:28.542 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-02 11:16:28.608 +03:00 [INF] RecalculateTopPosJob started at "2024-03-02T11:16:28.6077917+03:00"
2024-03-02 11:16:28.821 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-02 11:16:28.973 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-02 11:16:28.978 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-02 11:16:29.065 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-02 11:16:29.082 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-02 11:16:29.085 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=pa7bIvVbNyGPqQqJFph0hQ - -
2024-03-02 11:16:29.086 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 112.0189ms
2024-03-02 11:16:29.086 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-02 11:16:29.096 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 278.1001ms
2024-03-02 11:16:29.128 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-02 11:16:29.132 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 3.5533ms
2024-03-02 11:16:29.133 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-02 11:16:29.151 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 18.1805ms
2024-03-02 11:16:29.214 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-02 11:16:29.329 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 115.2187ms
2024-03-02 11:16:30.130 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-02 11:16:30.296 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-02T11:16:30.2961573+03:00"
2024-03-02 11:16:38.609 +03:00 [INF] Start processing HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:16:38.612 +03:00 [INF] Sending HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:17:03.020 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/User application/json 165
2024-03-02 11:17:03.024 +03:00 [INF] Executing endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:17:03.053 +03:00 [INF] Route matched with {action = "PostUser", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.BaseModels.User]] PostUser(TgCheckerApi.Models.UserPostModel) on controller TgCheckerApi.MapperProfiles.UserController (TgCheckerApi).
2024-03-02 11:17:03.453 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__user_TelegramId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.telegram_id = @__user_TelegramId_0
LIMIT 1
2024-03-02 11:17:03.488 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:17:03.496 +03:00 [INF] Executed action TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi) in 436.2106ms
2024-03-02 11:17:03.499 +03:00 [INF] Executed endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:17:03.515 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/User application/json 165 - 400 - text/plain;+charset=utf-8 495.0289ms
2024-03-02 11:17:04.748 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - -
2024-03-02 11:17:04.751 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:17:04.756 +03:00 [INF] Route matched with {action = "GetChannelsByUser", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[TgCheckerApi.Models.BaseModels.Channel]]] GetChannelsByUser(Int64) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:17:04.758 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:17:04.760 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:17:04.939 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE u.telegram_id = @__userId_0
2024-03-02 11:17:04.943 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[TgCheckerApi.Models.BaseModels.Channel, TgCheckerApi, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-03-02 11:17:04.979 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi) in 220.9667ms
2024-03-02 11:17:04.980 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:17:04.981 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - - - 200 15967 application/json;+charset=utf-8 233.0153ms
2024-03-02 11:17:05.918 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/80 - -
2024-03-02 11:17:05.921 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:17:05.925 +03:00 [INF] Route matched with {action = "GetChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.GetModels.ChannelGetModel]] GetChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:17:05.958 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__p_0
LIMIT 1
2024-03-02 11:17:06.034 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__channel_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel, c.tag, t.id, t.text
FROM "ChannelHasTag" AS c
LEFT JOIN "Tag" AS t ON c.tag = t.id
WHERE c.channel = @__channel_Id_0
2024-03-02 11:17:06.109 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel_id, c.expires, c.type_id
FROM "ChannelHasSubscription" AS c
WHERE c.channel_id = @__p_0
2024-03-02 11:17:06.121 +03:00 [INF] Executing ObjectResult, writing value of type 'TgCheckerApi.Models.GetModels.ChannelGetModel'.
2024-03-02 11:17:06.127 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi) in 200.8607ms
2024-03-02 11:17:06.128 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:17:06.130 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/80 - - - 200 15629 application/json;+charset=utf-8 212.4585ms
2024-03-02 11:17:06.922 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:17:06.923 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:17:06.929 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:17:06.946 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:17:06.952 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:17:06.953 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 21.7336ms
2024-03-02 11:17:06.953 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:17:06.955 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 400 - text/plain;+charset=utf-8 32.6933ms
2024-03-02 11:17:35.530 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:17:35.532 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:17:35.533 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:17:35.542 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:17:35.568 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:17:35.695 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:17:35.754 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:17:35.769 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:17:35.878 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:17:35.910 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:21:54.602 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-02 11:21:54.786 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-02 11:21:54.825 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-02 11:21:54.829 +03:00 [INF] Quartz Scheduler created
2024-03-02 11:21:54.830 +03:00 [INF] RAMJobStore initialized.
2024-03-02 11:21:54.831 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-02 11:21:54.832 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-02 11:21:54.832 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-02 11:21:54.833 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:21:54.876 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:21:54.970 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-02 11:21:54.971 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-02 11:21:54.975 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-02 11:21:54.976 +03:00 [INF] Hosting environment: Development
2024-03-02 11:21:54.977 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-02 11:21:55.047 +03:00 [INF] RecalculateTopPosJob started at "2024-03-02T11:21:55.0468875+03:00"
2024-03-02 11:21:55.110 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-02 11:21:55.142 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-02 11:21:55.203 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-02 11:21:55.241 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-02 11:21:55.292 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 181.6742ms
2024-03-02 11:21:55.294 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=e6602rJ0CslQP8MQRa_QYQ - -
2024-03-02 11:21:55.300 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-02 11:21:55.391 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-02 11:21:55.580 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 189.1045ms
2024-03-02 11:21:55.604 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-02 11:21:55.609 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 5.8067ms
2024-03-02 11:21:55.616 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-02 11:21:55.632 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 15.9816ms
2024-03-02 11:21:55.692 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-02 11:21:55.806 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 114.2322ms
2024-03-02 11:21:56.632 +03:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-02 11:21:56.804 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-02T11:21:56.8047502+03:00"
2024-03-02 11:22:05.062 +03:00 [INF] Start processing HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:22:05.066 +03:00 [INF] Sending HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:22:24.883 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/User application/json 165
2024-03-02 11:22:24.890 +03:00 [INF] Executing endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:22:24.918 +03:00 [INF] Route matched with {action = "PostUser", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.BaseModels.User]] PostUser(TgCheckerApi.Models.UserPostModel) on controller TgCheckerApi.MapperProfiles.UserController (TgCheckerApi).
2024-03-02 11:22:25.339 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__user_TelegramId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.telegram_id = @__user_TelegramId_0
LIMIT 1
2024-03-02 11:22:25.378 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:22:25.387 +03:00 [INF] Executed action TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi) in 460.5852ms
2024-03-02 11:22:25.392 +03:00 [INF] Executed endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:22:25.408 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/User application/json 165 - 400 - text/plain;+charset=utf-8 525.1693ms
2024-03-02 11:22:26.319 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - -
2024-03-02 11:22:26.322 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:22:26.326 +03:00 [INF] Route matched with {action = "GetChannelsByUser", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[TgCheckerApi.Models.BaseModels.Channel]]] GetChannelsByUser(Int64) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:22:26.329 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:22:26.329 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:22:26.512 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE u.telegram_id = @__userId_0
2024-03-02 11:22:26.515 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[TgCheckerApi.Models.BaseModels.Channel, TgCheckerApi, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-03-02 11:22:26.550 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi) in 222.2456ms
2024-03-02 11:22:26.551 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:22:26.552 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - - - 200 15968 application/json;+charset=utf-8 233.4424ms
2024-03-02 11:22:28.724 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/80 - -
2024-03-02 11:22:28.740 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:22:28.744 +03:00 [INF] Route matched with {action = "GetChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.GetModels.ChannelGetModel]] GetChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:22:28.823 +03:00 [INF] Executed DbCommand (50ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__p_0
LIMIT 1
2024-03-02 11:22:28.904 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__channel_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel, c.tag, t.id, t.text
FROM "ChannelHasTag" AS c
LEFT JOIN "Tag" AS t ON c.tag = t.id
WHERE c.channel = @__channel_Id_0
2024-03-02 11:22:28.976 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel_id, c.expires, c.type_id
FROM "ChannelHasSubscription" AS c
WHERE c.channel_id = @__p_0
2024-03-02 11:22:28.989 +03:00 [INF] Executing ObjectResult, writing value of type 'TgCheckerApi.Models.GetModels.ChannelGetModel'.
2024-03-02 11:22:28.996 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi) in 250.3085ms
2024-03-02 11:22:28.998 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:22:29.000 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/80 - - - 200 15630 application/json;+charset=utf-8 275.7758ms
2024-03-02 11:22:30.127 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:22:30.128 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:22:30.132 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:22:30.153 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:22:30.177 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:22:30.314 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:22:30.362 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:22:30.378 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:22:30.553 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:22:30.584 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:22:30.584 +03:00 [INF] NotificationJob started at "2024-03-02T11:22:30.5846184+03:00"
2024-03-02 11:22:30.585 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 451.9167ms
2024-03-02 11:22:30.588 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:22:30.592 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 464.7947ms
2024-03-02 11:22:30.595 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:22:30.602 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:22:30.627 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Notification" (channel_id, content, content_type, date, is_new, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7)
RETURNING id;
2024-03-02 11:22:30.637 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.id = @__userId_0
LIMIT 1
2024-03-02 11:22:30.658 +03:00 [INF] Start processing HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-02 11:22:30.659 +03:00 [INF] Sending HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-02 11:22:31.884 +03:00 [INF] Received HTTP response headers after 1219.3258ms - 200
2024-03-02 11:22:31.886 +03:00 [INF] End processing HTTP request after 1228.4001ms - 200
2024-03-02 11:22:31.890 +03:00 [INF] NotificationJob executed successfully.
2024-03-02 11:22:38.516 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:22:38.518 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:22:38.519 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:22:38.523 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:22:38.529 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:22:38.530 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 8.9484ms
2024-03-02 11:22:38.531 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:22:38.532 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 400 - text/plain;+charset=utf-8 16.0490ms
2024-03-02 11:23:15.764 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:23:15.765 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:23:15.766 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:23:15.771 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:23:15.773 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:23:15.774 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 6.9434ms
2024-03-02 11:23:15.776 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:23:15.777 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 400 - text/plain;+charset=utf-8 12.9994ms
2024-03-02 11:23:45.144 +03:00 [ERR] Error occurred executing UpdateSubscribersJob via HTTP request.
System.Threading.Tasks.TaskCanceledException: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
 ---> System.TimeoutException: The operation was canceled.
 ---> System.Threading.Tasks.TaskCanceledException: The operation was canceled.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](TIOAdapter adapter)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](TIOAdapter adapter, Memory`1 buffer)
   at System.Net.Http.HttpConnection.InitialFillAsync(Boolean async)
   at System.Net.Http.HttpConnection.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   --- End of inner exception stack trace ---
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpClient.HandleFailure(Exception e, Boolean telemetryStarted, HttpResponseMessage response, CancellationTokenSource cts, CancellationToken cancellationToken, CancellationTokenSource pendingRequestsCts)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at TgCheckerApi.Job.UpdateSubscribersJob.Execute(IJobExecutionContext context) in C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\Job\UpdateSubscribersJob.cs:line 49
2024-03-02 11:25:10.783 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-02 11:25:13.808 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-02 11:25:13.845 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-02 11:25:13.849 +03:00 [INF] Quartz Scheduler created
2024-03-02 11:25:13.850 +03:00 [INF] RAMJobStore initialized.
2024-03-02 11:25:13.851 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-02 11:25:13.851 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-02 11:25:13.852 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-02 11:25:13.853 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:25:13.891 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:25:13.990 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-02 11:25:13.991 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-02 11:25:13.996 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-02 11:25:13.996 +03:00 [INF] Hosting environment: Development
2024-03-02 11:25:13.997 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-02 11:25:14.063 +03:00 [INF] RecalculateTopPosJob started at "2024-03-02T11:25:14.0633743+03:00"
2024-03-02 11:25:14.603 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-02 11:25:14.893 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 292.8156ms
2024-03-02 11:25:14.914 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-02 11:25:14.917 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 3.3745ms
2024-03-02 11:25:14.923 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-02 11:25:14.941 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 17.5935ms
2024-03-02 11:25:15.003 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-02 11:25:15.122 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 118.9691ms
2024-03-02 11:25:15.631 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-02 11:25:15.636 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-02 11:25:15.707 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-02 11:25:15.725 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-02 11:25:15.726 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 95.3860ms
2024-03-02 11:25:15.726 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-02 11:25:15.727 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=NMBlZn-wuyNEBJdZGtX7tg - -
2024-03-02 11:25:15.732 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-02 11:25:15.900 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-02T11:25:15.9004776+03:00"
2024-03-02 11:25:24.071 +03:00 [INF] Start processing HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:25:24.076 +03:00 [INF] Sending HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:25:36.802 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/User application/json 165
2024-03-02 11:25:36.805 +03:00 [INF] Executing endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:25:36.835 +03:00 [INF] Route matched with {action = "PostUser", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.BaseModels.User]] PostUser(TgCheckerApi.Models.UserPostModel) on controller TgCheckerApi.MapperProfiles.UserController (TgCheckerApi).
2024-03-02 11:25:37.238 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__user_TelegramId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.telegram_id = @__user_TelegramId_0
LIMIT 1
2024-03-02 11:25:37.275 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:25:37.284 +03:00 [INF] Executed action TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi) in 439.9816ms
2024-03-02 11:25:37.287 +03:00 [INF] Executed endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:25:37.303 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/User application/json 165 - 400 - text/plain;+charset=utf-8 501.1951ms
2024-03-02 11:25:38.591 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - -
2024-03-02 11:25:38.594 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:25:38.600 +03:00 [INF] Route matched with {action = "GetChannelsByUser", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[TgCheckerApi.Models.BaseModels.Channel]]] GetChannelsByUser(Int64) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:25:38.602 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:25:38.603 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:25:38.787 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE u.telegram_id = @__userId_0
2024-03-02 11:25:38.792 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[TgCheckerApi.Models.BaseModels.Channel, TgCheckerApi, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-03-02 11:25:38.830 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi) in 227.8164ms
2024-03-02 11:25:38.833 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:25:38.834 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - - - 200 15968 application/json;+charset=utf-8 242.8817ms
2024-03-02 11:25:40.020 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/80 - -
2024-03-02 11:25:40.023 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:25:40.027 +03:00 [INF] Route matched with {action = "GetChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.GetModels.ChannelGetModel]] GetChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:25:40.056 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__p_0
LIMIT 1
2024-03-02 11:25:40.136 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__channel_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel, c.tag, t.id, t.text
FROM "ChannelHasTag" AS c
LEFT JOIN "Tag" AS t ON c.tag = t.id
WHERE c.channel = @__channel_Id_0
2024-03-02 11:25:40.209 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel_id, c.expires, c.type_id
FROM "ChannelHasSubscription" AS c
WHERE c.channel_id = @__p_0
2024-03-02 11:25:40.220 +03:00 [INF] Executing ObjectResult, writing value of type 'TgCheckerApi.Models.GetModels.ChannelGetModel'.
2024-03-02 11:25:40.228 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi) in 198.8976ms
2024-03-02 11:25:40.236 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:25:40.239 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/80 - - - 200 15630 application/json;+charset=utf-8 219.5881ms
2024-03-02 11:25:41.226 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:25:41.228 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:25:41.233 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:25:41.253 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:25:41.284 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:25:41.445 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:25:41.494 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:25:41.510 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:25:41.618 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:25:41.650 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:25:41.651 +03:00 [INF] NotificationJob started at "2024-03-02T11:25:41.6509365+03:00"
2024-03-02 11:25:41.651 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 415.8371ms
2024-03-02 11:25:41.653 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:25:41.655 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 429.6154ms
2024-03-02 11:25:41.660 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:25:41.664 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:25:41.686 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Notification" (channel_id, content, content_type, date, is_new, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7)
RETURNING id;
2024-03-02 11:25:41.695 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.id = @__userId_0
LIMIT 1
2024-03-02 11:25:41.719 +03:00 [INF] Start processing HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-02 11:25:41.738 +03:00 [INF] Sending HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-02 11:25:43.001 +03:00 [INF] Received HTTP response headers after 1247.2396ms - 200
2024-03-02 11:25:43.003 +03:00 [INF] End processing HTTP request after 1283.8223ms - 200
2024-03-02 11:25:43.008 +03:00 [INF] NotificationJob executed successfully.
2024-03-02 11:27:04.138 +03:00 [ERR] Error occurred executing UpdateSubscribersJob via HTTP request.
System.Threading.Tasks.TaskCanceledException: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
 ---> System.TimeoutException: The operation was canceled.
 ---> System.Threading.Tasks.TaskCanceledException: The operation was canceled.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](TIOAdapter adapter)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](TIOAdapter adapter, Memory`1 buffer)
   at System.Net.Http.HttpConnection.InitialFillAsync(Boolean async)
   at System.Net.Http.HttpConnection.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   --- End of inner exception stack trace ---
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpClient.HandleFailure(Exception e, Boolean telemetryStarted, HttpResponseMessage response, CancellationTokenSource cts, CancellationToken cancellationToken, CancellationTokenSource pendingRequestsCts)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at TgCheckerApi.Job.UpdateSubscribersJob.Execute(IJobExecutionContext context) in C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\Job\UpdateSubscribersJob.cs:line 49
2024-03-02 11:33:14.519 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-02 11:33:14.851 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-02 11:33:14.897 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-02 11:33:14.909 +03:00 [INF] Quartz Scheduler created
2024-03-02 11:33:14.910 +03:00 [INF] RAMJobStore initialized.
2024-03-02 11:33:14.911 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-02 11:33:14.912 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-02 11:33:14.912 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-02 11:33:14.913 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:33:14.954 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:33:15.046 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-02 11:33:15.050 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-02 11:33:15.053 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-02 11:33:15.055 +03:00 [INF] Hosting environment: Development
2024-03-02 11:33:15.055 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-02 11:33:15.132 +03:00 [INF] RecalculateTopPosJob started at "2024-03-02T11:33:15.1316512+03:00"
2024-03-02 11:33:15.651 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-02 11:33:15.904 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 255.8766ms
2024-03-02 11:33:15.925 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-02 11:33:15.928 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 2.9685ms
2024-03-02 11:33:15.935 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-02 11:33:15.953 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 18.2242ms
2024-03-02 11:33:16.044 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-02 11:33:16.093 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-02 11:33:16.098 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-02 11:33:16.164 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-02 11:33:16.178 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-02 11:33:16.179 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 85.6690ms
2024-03-02 11:33:16.180 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=Wc6xIg8rcRU6vXS0qSTuCg - -
2024-03-02 11:33:16.181 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-02 11:33:16.193 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 149.3473ms
2024-03-02 11:33:16.637 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-02 11:33:16.816 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-02T11:33:16.8163430+03:00"
2024-03-02 11:33:19.639 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/User application/json 165
2024-03-02 11:33:19.641 +03:00 [INF] Executing endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:33:19.658 +03:00 [INF] Route matched with {action = "PostUser", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.BaseModels.User]] PostUser(TgCheckerApi.Models.UserPostModel) on controller TgCheckerApi.MapperProfiles.UserController (TgCheckerApi).
2024-03-02 11:33:19.970 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__user_TelegramId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.telegram_id = @__user_TelegramId_0
LIMIT 1
2024-03-02 11:33:19.996 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:33:20.001 +03:00 [INF] Executed action TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi) in 337.4395ms
2024-03-02 11:33:20.004 +03:00 [INF] Executed endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:33:20.013 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/User application/json 165 - 400 - text/plain;+charset=utf-8 374.7377ms
2024-03-02 11:33:20.985 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - -
2024-03-02 11:33:20.988 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:33:20.993 +03:00 [INF] Route matched with {action = "GetChannelsByUser", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[TgCheckerApi.Models.BaseModels.Channel]]] GetChannelsByUser(Int64) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:33:20.996 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:33:20.997 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:33:21.177 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE u.telegram_id = @__userId_0
2024-03-02 11:33:21.181 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[TgCheckerApi.Models.BaseModels.Channel, TgCheckerApi, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-03-02 11:33:21.254 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi) in 259.1223ms
2024-03-02 11:33:21.255 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:33:21.256 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - - - 200 15968 application/json;+charset=utf-8 270.8431ms
2024-03-02 11:33:22.300 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/80 - -
2024-03-02 11:33:22.304 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:33:22.308 +03:00 [INF] Route matched with {action = "GetChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.GetModels.ChannelGetModel]] GetChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:33:22.341 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__p_0
LIMIT 1
2024-03-02 11:33:22.416 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__channel_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel, c.tag, t.id, t.text
FROM "ChannelHasTag" AS c
LEFT JOIN "Tag" AS t ON c.tag = t.id
WHERE c.channel = @__channel_Id_0
2024-03-02 11:33:22.491 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel_id, c.expires, c.type_id
FROM "ChannelHasSubscription" AS c
WHERE c.channel_id = @__p_0
2024-03-02 11:33:22.503 +03:00 [INF] Executing ObjectResult, writing value of type 'TgCheckerApi.Models.GetModels.ChannelGetModel'.
2024-03-02 11:33:22.510 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi) in 199.014ms
2024-03-02 11:33:22.511 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:33:22.513 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/80 - - - 200 15630 application/json;+charset=utf-8 212.5029ms
2024-03-02 11:33:23.293 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:33:23.295 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:33:23.300 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:33:23.317 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:33:23.343 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:33:23.467 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:33:23.498 +03:00 [INF] Scheduled time for notification: 3/2/2024 11:26:41 AM
2024-03-02 11:33:23.522 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:33:23.539 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:33:23.635 +03:00 [ERR] Failed executing DbCommand (5ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:33:23.674 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'TgCheckerApi.Models.BaseModels.TgDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> System.InvalidCastException: Cannot write DateTime with Kind=Local to PostgreSQL type 'timestamp with time zone', only UTC is supported. Note that it's not possible to mix DateTimes with different Kinds in an array/range. See the Npgsql.EnableLegacyTimestampBehavior AppContext switch to enable legacy behavior.
   at Npgsql.Internal.TypeHandlers.DateTimeHandlers.TimestampTzHandler.ValidateAndGetLength(DateTime value, NpgsqlParameter parameter)
   at Npgsql.Internal.TypeHandlers.DateTimeHandlers.TimestampTzHandler.ValidateObjectAndGetLength(Object value, NpgsqlLengthCache& lengthCache, NpgsqlParameter parameter)
   at Npgsql.NpgsqlParameter.ValidateAndGetLength()
   at Npgsql.NpgsqlParameterCollection.ProcessParameters(TypeMapper typeMapper, Boolean validateValues, CommandType commandType)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> System.InvalidCastException: Cannot write DateTime with Kind=Local to PostgreSQL type 'timestamp with time zone', only UTC is supported. Note that it's not possible to mix DateTimes with different Kinds in an array/range. See the Npgsql.EnableLegacyTimestampBehavior AppContext switch to enable legacy behavior.
   at Npgsql.Internal.TypeHandlers.DateTimeHandlers.TimestampTzHandler.ValidateAndGetLength(DateTime value, NpgsqlParameter parameter)
   at Npgsql.Internal.TypeHandlers.DateTimeHandlers.TimestampTzHandler.ValidateObjectAndGetLength(Object value, NpgsqlLengthCache& lengthCache, NpgsqlParameter parameter)
   at Npgsql.NpgsqlParameter.ValidateAndGetLength()
   at Npgsql.NpgsqlParameterCollection.ProcessParameters(TypeMapper typeMapper, Boolean validateValues, CommandType commandType)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-03-02 11:33:23.804 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 501.8056ms
2024-03-02 11:33:23.805 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:33:23.807 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> System.InvalidCastException: Cannot write DateTime with Kind=Local to PostgreSQL type 'timestamp with time zone', only UTC is supported. Note that it's not possible to mix DateTimes with different Kinds in an array/range. See the Npgsql.EnableLegacyTimestampBehavior AppContext switch to enable legacy behavior.
   at Npgsql.Internal.TypeHandlers.DateTimeHandlers.TimestampTzHandler.ValidateAndGetLength(DateTime value, NpgsqlParameter parameter)
   at Npgsql.Internal.TypeHandlers.DateTimeHandlers.TimestampTzHandler.ValidateObjectAndGetLength(Object value, NpgsqlLengthCache& lengthCache, NpgsqlParameter parameter)
   at Npgsql.NpgsqlParameter.ValidateAndGetLength()
   at Npgsql.NpgsqlParameterCollection.ProcessParameters(TypeMapper typeMapper, Boolean validateValues, CommandType commandType)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at TgCheckerApi.Services.NotificationService.CreateNotificationDelayedTaskAsync(String content, Int32 typeId, Int32 userId, DateTime scheduledTime, Boolean targetTelegram, String contentType, Nullable`1 channelId) in C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\Services\NotificationService.cs:line 178
   at TgCheckerApi.Controllers.ChannelController.BumpChannel(Int32 id) in C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\Controllers\ChannelController.cs:line 432
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2024-03-02 11:33:23.844 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 500 - text/plain;+charset=utf-8 551.0599ms
2024-03-02 11:33:25.034 +03:00 [INF] Start processing HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:33:25.038 +03:00 [INF] Sending HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:33:25.376 +03:00 [INF] Received HTTP response headers after 331.6082ms - 200
2024-03-02 11:33:25.379 +03:00 [INF] End processing HTTP request after 347.4378ms - 200
2024-03-02 11:33:25.383 +03:00 [INF] Successfully processed all channels via HTTP request at: {DateTime.UtcNow}
2024-03-02 11:33:54.117 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-02 11:33:57.203 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-02 11:33:57.238 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-02 11:33:57.241 +03:00 [INF] Quartz Scheduler created
2024-03-02 11:33:57.242 +03:00 [INF] RAMJobStore initialized.
2024-03-02 11:33:57.243 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-02 11:33:57.243 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-02 11:33:57.244 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-02 11:33:57.245 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:33:57.283 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:33:57.372 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-02 11:33:57.373 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-02 11:33:57.376 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-02 11:33:57.377 +03:00 [INF] Hosting environment: Development
2024-03-02 11:33:57.377 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-02 11:33:57.445 +03:00 [INF] RecalculateTopPosJob started at "2024-03-02T11:33:57.4448234+03:00"
2024-03-02 11:33:57.742 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-02 11:33:57.742 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-02 11:33:57.773 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-02 11:33:57.836 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-02 11:33:57.867 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-02 11:33:57.871 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=ytd3UC07b9FRy2EYZNYRZg - -
2024-03-02 11:33:57.871 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 131.4802ms
2024-03-02 11:33:57.873 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-02 11:33:57.999 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 260.2938ms
2024-03-02 11:33:58.017 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-02 11:33:58.021 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 4.2247ms
2024-03-02 11:33:58.031 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-02 11:33:58.050 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 18.9991ms
2024-03-02 11:33:58.136 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-02 11:33:58.250 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 113.6263ms
2024-03-02 11:33:58.950 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-02 11:33:59.117 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-02T11:33:59.1170392+03:00"
2024-03-02 11:34:07.469 +03:00 [INF] Start processing HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:34:07.472 +03:00 [INF] Sending HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:34:13.385 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:34:13.389 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:34:13.416 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:34:13.558 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:34:13.559 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:34:13.863 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:34:13.918 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:34:13.926 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 502.3529ms
2024-03-02 11:34:13.928 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:34:13.944 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 400 - text/plain;+charset=utf-8 558.5736ms
2024-03-02 11:34:16.490 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - -
2024-03-02 11:34:16.495 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:34:16.499 +03:00 [INF] Route matched with {action = "GetChannelsByUser", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[TgCheckerApi.Models.BaseModels.Channel]]] GetChannelsByUser(Int64) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:34:16.575 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE u.telegram_id = @__userId_0
2024-03-02 11:34:16.580 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[TgCheckerApi.Models.BaseModels.Channel, TgCheckerApi, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-03-02 11:34:16.624 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi) in 122.5636ms
2024-03-02 11:34:16.625 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:34:16.626 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - - - 200 15968 application/json;+charset=utf-8 135.8215ms
2024-03-02 11:34:17.969 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/80 - -
2024-03-02 11:34:17.972 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:34:17.976 +03:00 [INF] Route matched with {action = "GetChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.GetModels.ChannelGetModel]] GetChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:34:18.002 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__p_0
LIMIT 1
2024-03-02 11:34:18.051 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__channel_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel, c.tag, t.id, t.text
FROM "ChannelHasTag" AS c
LEFT JOIN "Tag" AS t ON c.tag = t.id
WHERE c.channel = @__channel_Id_0
2024-03-02 11:34:18.107 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel_id, c.expires, c.type_id
FROM "ChannelHasSubscription" AS c
WHERE c.channel_id = @__p_0
2024-03-02 11:34:18.120 +03:00 [INF] Executing ObjectResult, writing value of type 'TgCheckerApi.Models.GetModels.ChannelGetModel'.
2024-03-02 11:34:18.129 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi) in 147.9486ms
2024-03-02 11:34:18.130 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:34:18.132 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/80 - - - 200 15630 application/json;+charset=utf-8 163.3376ms
2024-03-02 11:34:18.879 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:34:18.881 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:34:18.882 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:34:18.890 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:34:18.895 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:34:18.896 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 12.8892ms
2024-03-02 11:34:18.897 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:34:18.898 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 400 - text/plain;+charset=utf-8 18.7587ms
2024-03-02 11:35:22.430 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:35:22.432 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:35:22.433 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:35:22.439 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:35:22.463 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:35:22.598 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:35:22.630 +03:00 [INF] Scheduled time for notification: 3/2/2024 8:34:23 AM
2024-03-02 11:35:22.652 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:35:22.669 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:35:22.976 +03:00 [INF] Executed DbCommand (220ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:35:23.005 +03:00 [INF] NotificationJob started at "2024-03-02T11:35:23.0054876+03:00"
2024-03-02 11:35:23.009 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:35:23.013 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 577.7847ms
2024-03-02 11:35:23.011 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:35:23.014 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:35:23.020 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 589.4115ms
2024-03-02 11:35:23.020 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:35:23.047 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Notification" (channel_id, content, content_type, date, is_new, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7)
RETURNING id;
2024-03-02 11:35:23.057 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.id = @__userId_0
LIMIT 1
2024-03-02 11:35:23.077 +03:00 [INF] Start processing HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-02 11:35:23.078 +03:00 [INF] Sending HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-02 11:35:24.292 +03:00 [INF] Received HTTP response headers after 1207.952ms - 200
2024-03-02 11:35:24.294 +03:00 [INF] End processing HTTP request after 1216.7553ms - 200
2024-03-02 11:35:24.299 +03:00 [INF] NotificationJob executed successfully.
2024-03-02 11:35:47.548 +03:00 [ERR] Error occurred executing UpdateSubscribersJob via HTTP request.
System.Threading.Tasks.TaskCanceledException: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
 ---> System.TimeoutException: The operation was canceled.
 ---> System.Threading.Tasks.TaskCanceledException: The operation was canceled.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](TIOAdapter adapter)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](TIOAdapter adapter, Memory`1 buffer)
   at System.Net.Http.HttpConnection.InitialFillAsync(Boolean async)
   at System.Net.Http.HttpConnection.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   --- End of inner exception stack trace ---
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpClient.HandleFailure(Exception e, Boolean telemetryStarted, HttpResponseMessage response, CancellationTokenSource cts, CancellationToken cancellationToken, CancellationTokenSource pendingRequestsCts)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at TgCheckerApi.Job.UpdateSubscribersJob.Execute(IJobExecutionContext context) in C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\Job\UpdateSubscribersJob.cs:line 49
2024-03-02 11:36:37.670 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-02 11:36:37.859 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-02 11:36:37.898 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-02 11:36:37.899 +03:00 [INF] Quartz Scheduler created
2024-03-02 11:36:37.903 +03:00 [INF] RAMJobStore initialized.
2024-03-02 11:36:37.904 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-02 11:36:37.905 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-02 11:36:37.905 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-02 11:36:37.906 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:36:37.960 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:36:38.045 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-02 11:36:38.048 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-02 11:36:38.051 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-02 11:36:38.052 +03:00 [INF] Hosting environment: Development
2024-03-02 11:36:38.053 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-02 11:36:38.137 +03:00 [INF] RecalculateTopPosJob started at "2024-03-02T11:36:38.1373958+03:00"
2024-03-02 11:36:38.567 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-02 11:36:38.567 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-02 11:36:38.600 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-02 11:36:38.672 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-02 11:36:38.700 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-02 11:36:38.702 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=HFwI12grxv-Ay3VfwyrCmA - -
2024-03-02 11:36:38.703 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 140.0159ms
2024-03-02 11:36:38.704 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-02 11:36:38.840 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 277.2631ms
2024-03-02 11:36:38.862 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-02 11:36:38.864 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 2.8699ms
2024-03-02 11:36:38.869 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-02 11:36:38.887 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 17.5834ms
2024-03-02 11:36:38.947 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-02 11:36:39.066 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 119.4923ms
2024-03-02 11:36:39.770 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-02 11:36:40.032 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p3='?' (DbType = Int32), @p2='?' (DbType = Int32), @p5='?' (DbType = Int32), @p4='?' (DbType = Int32), @p7='?' (DbType = Int32), @p6='?' (DbType = Int32), @p9='?' (DbType = Int32), @p8='?' (DbType = Int32), @p11='?' (DbType = Int32), @p10='?' (DbType = Int32), @p13='?' (DbType = Int32), @p12='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET "TopPos" = @p0
WHERE id = @p1;
UPDATE "Channel" SET "TopPos" = @p2
WHERE id = @p3;
UPDATE "Channel" SET "TopPos" = @p4
WHERE id = @p5;
UPDATE "Channel" SET "TopPos" = @p6
WHERE id = @p7;
UPDATE "Channel" SET "TopPos" = @p8
WHERE id = @p9;
UPDATE "Channel" SET "TopPos" = @p10
WHERE id = @p11;
UPDATE "Channel" SET "TopPos" = @p12
WHERE id = @p13;
2024-03-02 11:36:40.071 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-02T11:36:40.0718184+03:00"
2024-03-02 11:36:44.297 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/User application/json 165
2024-03-02 11:36:44.301 +03:00 [INF] Executing endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:36:44.331 +03:00 [INF] Route matched with {action = "PostUser", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.BaseModels.User]] PostUser(TgCheckerApi.Models.UserPostModel) on controller TgCheckerApi.MapperProfiles.UserController (TgCheckerApi).
2024-03-02 11:36:44.818 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__user_TelegramId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.telegram_id = @__user_TelegramId_0
LIMIT 1
2024-03-02 11:36:44.861 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-02 11:36:44.869 +03:00 [INF] Executed action TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi) in 530.3861ms
2024-03-02 11:36:44.873 +03:00 [INF] Executed endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-02 11:36:44.888 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/User application/json 165 - 400 - text/plain;+charset=utf-8 591.2154ms
2024-03-02 11:36:45.944 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - -
2024-03-02 11:36:45.947 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:36:45.952 +03:00 [INF] Route matched with {action = "GetChannelsByUser", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[TgCheckerApi.Models.BaseModels.Channel]]] GetChannelsByUser(Int64) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:36:45.954 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:36:45.955 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:36:46.142 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE u.telegram_id = @__userId_0
2024-03-02 11:36:46.146 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[TgCheckerApi.Models.BaseModels.Channel, TgCheckerApi, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-03-02 11:36:46.222 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi) in 268.6301ms
2024-03-02 11:36:46.223 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-02 11:36:46.224 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - - - 200 15968 application/json;+charset=utf-8 280.2707ms
2024-03-02 11:36:47.057 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/80 - -
2024-03-02 11:36:47.060 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:36:47.065 +03:00 [INF] Route matched with {action = "GetChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.GetModels.ChannelGetModel]] GetChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:36:47.089 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__p_0
LIMIT 1
2024-03-02 11:36:47.165 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__channel_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel, c.tag, t.id, t.text
FROM "ChannelHasTag" AS c
LEFT JOIN "Tag" AS t ON c.tag = t.id
WHERE c.channel = @__channel_Id_0
2024-03-02 11:36:47.237 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel_id, c.expires, c.type_id
FROM "ChannelHasSubscription" AS c
WHERE c.channel_id = @__p_0
2024-03-02 11:36:47.248 +03:00 [INF] Executing ObjectResult, writing value of type 'TgCheckerApi.Models.GetModels.ChannelGetModel'.
2024-03-02 11:36:47.256 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi) in 189.5995ms
2024-03-02 11:36:47.259 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-02 11:36:47.261 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/80 - - - 200 15630 application/json;+charset=utf-8 203.7028ms
2024-03-02 11:36:48.020 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:36:48.022 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:36:48.025 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:36:48.032 +03:00 [INF] Start processing HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:36:48.036 +03:00 [INF] Sending HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:36:48.044 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:36:48.071 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:36:48.125 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:36:48.133 +03:00 [INF] Scheduled time for notification: 3/2/2024 8:37:48 AM
2024-03-02 11:36:48.158 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:36:48.178 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:36:48.302 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:36:48.337 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:36:48.339 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 310.3776ms
2024-03-02 11:36:48.342 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:36:48.344 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 324.0356ms
2024-03-02 11:37:04.304 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:37:04.306 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:37:04.307 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:37:04.316 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:37:04.319 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:37:04.324 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:37:04.327 +03:00 [INF] Scheduled time for notification: 3/2/2024 8:38:04 AM
2024-03-02 11:37:04.329 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:37:04.335 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:37:04.339 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:37:04.341 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:37:04.342 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 33.0159ms
2024-03-02 11:37:04.343 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:37:04.344 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 39.3048ms
2024-03-02 11:37:17.170 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:37:17.171 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:37:17.172 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:37:17.179 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:37:17.184 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:37:17.187 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:37:17.190 +03:00 [INF] Scheduled time for notification: 3/2/2024 8:38:17 AM
2024-03-02 11:37:17.192 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:37:17.196 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:37:17.201 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:37:17.203 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:37:17.204 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 28.0224ms
2024-03-02 11:37:17.206 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:37:17.207 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 36.7560ms
2024-03-02 11:37:35.576 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:37:35.578 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:37:35.579 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:37:35.588 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:37:35.597 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:37:35.601 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:37:35.609 +03:00 [INF] Scheduled time for notification: 3/2/2024 8:38:35 AM
2024-03-02 11:37:35.610 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:37:35.616 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:37:35.624 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:37:35.628 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:37:35.628 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 44.1033ms
2024-03-02 11:37:35.629 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:37:35.632 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 55.7206ms
2024-03-02 11:37:45.483 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-02 11:37:45.630 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-02 11:37:45.671 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-02 11:37:45.676 +03:00 [INF] Quartz Scheduler created
2024-03-02 11:37:45.677 +03:00 [INF] RAMJobStore initialized.
2024-03-02 11:37:45.678 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-02 11:37:45.678 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-02 11:37:45.679 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-02 11:37:45.680 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:37:45.724 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:37:45.835 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-02 11:37:45.840 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-02 11:37:45.843 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-02 11:37:45.844 +03:00 [INF] Hosting environment: Development
2024-03-02 11:37:45.845 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-02 11:37:45.910 +03:00 [INF] RecalculateTopPosJob started at "2024-03-02T11:37:45.9100617+03:00"
2024-03-02 11:37:46.452 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-02 11:37:46.703 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 253.4880ms
2024-03-02 11:37:46.727 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-02 11:37:46.732 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 4.7737ms
2024-03-02 11:37:46.734 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-02 11:37:46.754 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 19.9750ms
2024-03-02 11:37:46.815 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-02 11:37:46.943 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 128.0576ms
2024-03-02 11:37:47.445 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-02 11:37:47.687 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p3='?' (DbType = Int32), @p2='?' (DbType = Int32), @p5='?' (DbType = Int32), @p4='?' (DbType = Int32), @p7='?' (DbType = Int32), @p6='?' (DbType = Int32), @p9='?' (DbType = Int32), @p8='?' (DbType = Int32), @p11='?' (DbType = Int32), @p10='?' (DbType = Int32), @p13='?' (DbType = Int32), @p12='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET "TopPos" = @p0
WHERE id = @p1;
UPDATE "Channel" SET "TopPos" = @p2
WHERE id = @p3;
UPDATE "Channel" SET "TopPos" = @p4
WHERE id = @p5;
UPDATE "Channel" SET "TopPos" = @p6
WHERE id = @p7;
UPDATE "Channel" SET "TopPos" = @p8
WHERE id = @p9;
UPDATE "Channel" SET "TopPos" = @p10
WHERE id = @p11;
UPDATE "Channel" SET "TopPos" = @p12
WHERE id = @p13;
2024-03-02 11:37:47.741 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-02T11:37:47.7419088+03:00"
2024-03-02 11:37:48.783 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-02 11:37:48.789 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-02 11:37:48.858 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-02 11:37:48.872 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-02 11:37:48.873 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 89.7117ms
2024-03-02 11:37:48.874 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=gpvlMsVH-EOsPKpuYmIRIQ - -
2024-03-02 11:37:48.880 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-02 11:37:55.919 +03:00 [INF] Start processing HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:37:55.923 +03:00 [INF] Sending HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-02 11:38:00.284 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-02 11:38:00.289 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:38:00.323 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-02 11:38:00.479 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-02 11:38:00.480 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-02 11:38:00.758 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-02 11:38:00.833 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-02 11:38:00.876 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-02 11:38:00.890 +03:00 [INF] Scheduled time for notification: 3/2/2024 8:39:00 AM
2024-03-02 11:38:00.910 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:38:00.926 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:38:01.029 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-02 11:38:01.066 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-02 11:38:01.074 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 738.4714ms
2024-03-02 11:38:01.078 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-02 11:38:01.097 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 812.3510ms
2024-03-02 11:39:00.896 +03:00 [INF] NotificationJob started at "2024-03-02T11:39:00.8961900+03:00"
2024-03-02 11:39:00.956 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-02 11:39:00.961 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-02 11:39:00.985 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Notification" (channel_id, content, content_type, date, is_new, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7)
RETURNING id;
2024-03-02 11:39:01.000 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.id = @__userId_0
LIMIT 1
2024-03-02 11:39:01.019 +03:00 [INF] Start processing HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-02 11:39:01.020 +03:00 [INF] Sending HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-02 11:39:02.263 +03:00 [INF] Received HTTP response headers after 1237.3624ms - 200
2024-03-02 11:39:02.266 +03:00 [INF] End processing HTTP request after 1246.8844ms - 200
2024-03-02 11:39:02.270 +03:00 [INF] NotificationJob executed successfully.
