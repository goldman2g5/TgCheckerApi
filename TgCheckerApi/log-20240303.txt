2024-03-03 18:19:02.594 +03:00 [INF] User profile is available. Using 'C:\Users\timar\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-03-03 18:19:02.847 +03:00 [INF] Default Quartz.NET properties loaded from embedded resource file
2024-03-03 18:19:02.892 +03:00 [INF] Initialized Scheduler Signaller of type: Quartz.Core.SchedulerSignalerImpl
2024-03-03 18:19:02.893 +03:00 [INF] Quartz Scheduler created
2024-03-03 18:19:02.894 +03:00 [INF] RAMJobStore initialized.
2024-03-03 18:19:02.895 +03:00 [INF] Quartz Scheduler 3.8.0.0 - 'DefaultQuartzScheduler' with instanceId 'NON_CLUSTERED' initialized
2024-03-03 18:19:02.896 +03:00 [INF] Using thread pool 'Quartz.Simpl.DefaultThreadPool', size: 10
2024-03-03 18:19:02.897 +03:00 [INF] Using job store 'Quartz.Simpl.RAMJobStore', supports persistence: False, clustered: False
2024-03-03 18:19:02.898 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-03 18:19:02.948 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-03 18:19:03.138 +03:00 [INF] Now listening on: http://localhost:7256
2024-03-03 18:19:03.139 +03:00 [INF] Now listening on: http://localhost:5244
2024-03-03 18:19:03.143 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-03-03 18:19:03.143 +03:00 [INF] Hosting environment: Development
2024-03-03 18:19:03.144 +03:00 [INF] Content root path: C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\
2024-03-03 18:19:03.231 +03:00 [INF] RecalculateTopPosJob started at "2024-03-03T18:19:03.2310932+03:00"
2024-03-03 18:19:04.370 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger - -
2024-03-03 18:19:04.483 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger - - - 301 0 - 114.9265ms
2024-03-03 18:19:04.500 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/index.html - -
2024-03-03 18:19:04.541 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0
2024-03-03 18:19:04.545 +03:00 [WRN] Failed to determine the https port for redirect.
2024-03-03 18:19:04.895 +03:00 [INF] Executing endpoint '/BotHub/negotiate'
2024-03-03 18:19:04.911 +03:00 [INF] Executed endpoint '/BotHub/negotiate'
2024-03-03 18:19:04.912 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/BotHub/negotiate?negotiateVersion=0 - 0 - 200 273 application/json 370.8818ms
2024-03-03 18:19:04.937 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/BotHub?id=xAe3BM0cBWamRMDVgJ5kEg - -
2024-03-03 18:19:04.938 +03:00 [INF] Executing endpoint '/BotHub'
2024-03-03 18:19:04.983 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/index.html - - - 200 - text/html;charset=utf-8 482.5430ms
2024-03-03 18:19:05.006 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/swagger-ui.css - -
2024-03-03 18:19:05.007 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/swagger-ui-bundle.js - -
2024-03-03 18:19:05.030 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/swagger-ui-standalone-preset.js - -
2024-03-03 18:19:05.049 +03:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2024-03-03 18:19:05.049 +03:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2024-03-03 18:19:05.049 +03:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2024-03-03 18:19:05.050 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/swagger-ui.css - - - 200 144929 text/css 43.9139ms
2024-03-03 18:19:05.050 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/swagger-ui-bundle.js - - - 200 1061536 application/javascript 43.9266ms
2024-03-03 18:19:05.051 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/swagger-ui-standalone-preset.js - - - 200 312163 application/javascript 21.7064ms
2024-03-03 18:19:05.052 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - -
2024-03-03 18:19:05.056 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_framework/aspnetcore-browser-refresh.js - - - 200 12356 application/javascript;+charset=utf-8 3.9545ms
2024-03-03 18:19:05.066 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/_vs/browserLink - -
2024-03-03 18:19:05.097 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 31.0483ms
2024-03-03 18:19:05.239 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - -
2024-03-03 18:19:05.256 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/swagger/favicon-32x32.png - -
2024-03-03 18:19:05.257 +03:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2024-03-03 18:19:05.258 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/favicon-32x32.png - - - 200 628 image/png 2.1996ms
2024-03-03 18:19:05.361 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 121.5587ms
2024-03-03 18:19:07.159 +03:00 [INF] Executed DbCommand (136ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-03 18:19:07.337 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-03T18:19:07.3372013+03:00"
2024-03-03 18:19:09.724 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/User application/json 165
2024-03-03 18:19:09.726 +03:00 [INF] Executing endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-03 18:19:09.743 +03:00 [INF] Route matched with {action = "PostUser", controller = "User"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.BaseModels.User]] PostUser(TgCheckerApi.Models.UserPostModel) on controller TgCheckerApi.MapperProfiles.UserController (TgCheckerApi).
2024-03-03 18:19:10.119 +03:00 [INF] Executed DbCommand (110ms) [Parameters=[@__user_TelegramId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.telegram_id = @__user_TelegramId_0
LIMIT 1
2024-03-03 18:19:10.142 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2024-03-03 18:19:10.147 +03:00 [INF] Executed action TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi) in 400.0871ms
2024-03-03 18:19:10.149 +03:00 [INF] Executed endpoint 'TgCheckerApi.MapperProfiles.UserController.PostUser (TgCheckerApi)'
2024-03-03 18:19:10.158 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/User application/json 165 - 400 - text/plain;+charset=utf-8 434.5642ms
2024-03-03 18:19:13.036 +03:00 [INF] Start processing HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-03 18:19:13.039 +03:00 [INF] Sending HTTP request POST "https://tgsearch.info:8443/api/Bot/getSubscribersByChannels"
2024-03-03 18:19:18.872 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - -
2024-03-03 18:19:18.875 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-03 18:19:18.880 +03:00 [INF] Route matched with {action = "GetChannelsByUser", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[TgCheckerApi.Models.BaseModels.Channel]]] GetChannelsByUser(Int64) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-03 18:19:18.883 +03:00 [INF] JobFactory set to: TgCheckerApi.Quartz.QuartzJobFactory
2024-03-03 18:19:18.884 +03:00 [INF] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
2024-03-03 18:19:19.041 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__userId_0='?' (DbType = Int64)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE u.telegram_id = @__userId_0
2024-03-03 18:19:19.043 +03:00 [INF] Executing ObjectResult, writing value of type 'System.Collections.Generic.List`1[[TgCheckerApi.Models.BaseModels.Channel, TgCheckerApi, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2024-03-03 18:19:19.066 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi) in 183.506ms
2024-03-03 18:19:19.068 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannelsByUser (TgCheckerApi)'
2024-03-03 18:19:19.069 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/ByUser/1342147816 - - - 200 15968 application/json;+charset=utf-8 196.8753ms
2024-03-03 18:19:20.082 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:7256/api/Channel/80 - -
2024-03-03 18:19:20.084 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-03 18:19:20.088 +03:00 [INF] Route matched with {action = "GetChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[TgCheckerApi.Models.GetModels.ChannelGetModel]] GetChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-03 18:19:20.106 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__p_0
LIMIT 1
2024-03-03 18:19:20.251 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__channel_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel, c.tag, t.id, t.text
FROM "ChannelHasTag" AS c
LEFT JOIN "Tag" AS t ON c.tag = t.id
WHERE c.channel = @__channel_Id_0
2024-03-03 18:19:20.380 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.channel_id, c.expires, c.type_id
FROM "ChannelHasSubscription" AS c
WHERE c.channel_id = @__p_0
2024-03-03 18:19:20.387 +03:00 [INF] Executing ObjectResult, writing value of type 'TgCheckerApi.Models.GetModels.ChannelGetModel'.
2024-03-03 18:19:20.390 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi) in 301.1446ms
2024-03-03 18:19:20.391 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.GetChannel (TgCheckerApi)'
2024-03-03 18:19:20.393 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:7256/api/Channel/80 - - - 200 15630 application/json;+charset=utf-8 311.1704ms
2024-03-03 18:19:21.339 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-03 18:19:21.340 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-03 18:19:21.343 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-03 18:19:21.354 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-03 18:19:21.454 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-03 18:19:21.564 +03:00 [INF] Executed DbCommand (47ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-03 18:19:21.583 +03:00 [INF] Scheduled time for notification: 3/3/2024 3:20:21 PM
2024-03-03 18:19:21.623 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-03 18:19:21.635 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-03 18:19:21.824 +03:00 [INF] Executed DbCommand (134ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-03 18:19:21.845 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-03 18:19:21.846 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 501.201ms
2024-03-03 18:19:21.848 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-03 18:19:21.849 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 510.4095ms
2024-03-03 18:20:21.582 +03:00 [INF] NotificationJob started at "2024-03-03T18:20:21.5821126+03:00"
2024-03-03 18:20:21.588 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-03 18:20:21.596 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-03 18:20:21.718 +03:00 [INF] Executed DbCommand (108ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Notification" (channel_id, content, content_type, date, is_new, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7)
RETURNING id;
2024-03-03 18:20:21.727 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.id = @__userId_0
LIMIT 1
2024-03-03 18:20:21.741 +03:00 [INF] Start processing HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-03 18:20:21.743 +03:00 [INF] Sending HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-03 18:20:23.075 +03:00 [INF] Received HTTP response headers after 1327.5025ms - 200
2024-03-03 18:20:23.077 +03:00 [INF] End processing HTTP request after 1335.1436ms - 200
2024-03-03 18:20:23.095 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.channel_id, n.content, n.content_type, n.date, n.target_telegram, n.type_id, n.user_id
FROM "NotificationDelayedTask" AS n
WHERE n.id = @__p_0
LIMIT 1
2024-03-03 18:20:23.107 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "NotificationDelayedTask"
WHERE id = @p0;
2024-03-03 18:20:23.112 +03:00 [INF] NotificationJob executed successfully.
2024-03-03 18:20:53.104 +03:00 [ERR] Error occurred executing UpdateSubscribersJob via HTTP request.
System.Threading.Tasks.TaskCanceledException: The request was canceled due to the configured HttpClient.Timeout of 100 seconds elapsing.
 ---> System.TimeoutException: The operation was canceled.
 ---> System.Threading.Tasks.TaskCanceledException: The operation was canceled.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](TIOAdapter adapter)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](TIOAdapter adapter, Memory`1 buffer)
   at System.Net.Http.HttpConnection.InitialFillAsync(Boolean async)
   at System.Net.Http.HttpConnection.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpConnection.SendAsyncCore(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at System.Net.Http.HttpConnectionPool.SendWithVersionDetectionAndRetryAsync(HttpRequestMessage request, Boolean async, Boolean doRequestAuth, CancellationToken cancellationToken)
   at System.Net.Http.RedirectHandler.SendAsync(HttpRequestMessage request, Boolean async, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at Microsoft.Extensions.Http.Logging.LoggingScopeHttpMessageHandler.SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   --- End of inner exception stack trace ---
   --- End of inner exception stack trace ---
   at System.Net.Http.HttpClient.HandleFailure(Exception e, Boolean telemetryStarted, HttpResponseMessage response, CancellationTokenSource cts, CancellationToken cancellationToken, CancellationTokenSource pendingRequestsCts)
   at System.Net.Http.HttpClient.<SendAsync>g__Core|83_0(HttpRequestMessage request, HttpCompletionOption completionOption, CancellationTokenSource cts, Boolean disposeCts, CancellationTokenSource pendingRequestsCts, CancellationToken originalCancellationToken)
   at TgCheckerApi.Job.UpdateSubscribersJob.Execute(IJobExecutionContext context) in C:\Users\timar\source\Repos\goldman2g5\TgCheckerApi\TgCheckerApi\Job\UpdateSubscribersJob.cs:line 49
2024-03-03 18:20:55.255 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0
2024-03-03 18:20:55.256 +03:00 [INF] Executing endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-03 18:20:55.257 +03:00 [INF] Route matched with {action = "BumpChannel", controller = "Channel"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BumpChannel(Int32) on controller TgCheckerApi.Controllers.ChannelController (TgCheckerApi).
2024-03-03 18:20:55.264 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user", u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "Channel" AS c
LEFT JOIN "User" AS u ON c."user" = u.id
WHERE c.id = @__id_0
LIMIT 1
2024-03-03 18:20:55.269 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT s.multiplier
FROM "ChannelHasSubscription" AS c
LEFT JOIN "SubType" AS s ON c.type_id = s.id
WHERE c.channel_id = @__channelId_0
ORDER BY c.type_id DESC
LIMIT 1
2024-03-03 18:20:55.274 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
UPDATE "Channel" SET bumps = @p0, last_bump = @p1
WHERE id = @p2;
2024-03-03 18:20:55.276 +03:00 [INF] Scheduled time for notification: 3/3/2024 3:21:55 PM
2024-03-03 18:20:55.278 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-03 18:20:55.281 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-03 18:20:55.285 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "NotificationDelayedTask" (channel_id, content, content_type, date, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6)
RETURNING id;
2024-03-03 18:20:55.290 +03:00 [INF] Executing StatusCodeResult, setting HTTP status code 204
2024-03-03 18:20:55.292 +03:00 [INF] Executed action TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi) in 32.4774ms
2024-03-03 18:20:55.293 +03:00 [INF] Executed endpoint 'TgCheckerApi.Controllers.ChannelController.BumpChannel (TgCheckerApi)'
2024-03-03 18:20:55.295 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:7256/api/Channel/Bump/80 - 0 - 204 - - 40.0724ms
2024-03-03 18:21:55.289 +03:00 [INF] NotificationJob started at "2024-03-03T18:21:55.2894402+03:00"
2024-03-03 18:21:55.291 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__typeId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.text
FROM "NotificationType" AS n
WHERE n.id = @__typeId_0
LIMIT 1
2024-03-03 18:21:55.295 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__channelId_Value_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
WHERE c.id = @__channelId_Value_0
LIMIT 1
2024-03-03 18:21:55.299 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?', @p2='?', @p3='?' (DbType = DateTime), @p4='?' (DbType = Boolean), @p5='?' (DbType = Boolean), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Notification" (channel_id, content, content_type, date, is_new, target_telegram, type_id, user_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7)
RETURNING id;
2024-03-03 18:21:55.302 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT u.id, u.avatar, u.chat_id, u.last_update, u.notification_settings, u.telegram_id, u.unique_key, u.username
FROM "User" AS u
WHERE u.id = @__userId_0
LIMIT 1
2024-03-03 18:21:55.304 +03:00 [INF] Start processing HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-03 18:21:55.305 +03:00 [INF] Sending HTTP request POST "http://127.0.0.1:8000/send_notifications"
2024-03-03 18:21:56.560 +03:00 [INF] Received HTTP response headers after 1254.4323ms - 200
2024-03-03 18:21:56.561 +03:00 [INF] End processing HTTP request after 1257.6296ms - 200
2024-03-03 18:21:56.564 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT n.id, n.channel_id, n.content, n.content_type, n.date, n.target_telegram, n.type_id, n.user_id
FROM "NotificationDelayedTask" AS n
WHERE n.id = @__p_0
LIMIT 1
2024-03-03 18:21:56.601 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM "NotificationDelayedTask"
WHERE id = @p0;
2024-03-03 18:21:56.603 +03:00 [INF] NotificationJob executed successfully.
2024-03-03 20:16:00.009 +03:00 [INF] RecalculateTopPosJob started at "2024-03-03T20:16:00.0096867+03:00"
2024-03-03 20:16:00.339 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT c.id, c.avatar, c.bumps, c.description, c.flag, c."Hidden", c."IsPartner", c.language, c.last_bump, c.members, c.name, c.notification_sent, c.notifications, c.promo_post, c.promo_post_interval, c.promo_post_last, c.promo_post_sent, c.promo_post_time, c.telegram_id, c."TopPos", c."Url", c."user"
FROM "Channel" AS c
ORDER BY c.bumps DESC
2024-03-03 20:16:00.342 +03:00 [INF] RecalculateTopPosJob completed at "2024-03-03T20:16:00.3427414+03:00"
